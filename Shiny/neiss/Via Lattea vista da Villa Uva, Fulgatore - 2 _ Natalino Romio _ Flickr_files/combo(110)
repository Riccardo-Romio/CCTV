YUI.add("hermes-template-download-tooltip",(function(n,e){var t=n.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(n,e,t,a,l){var o,r=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,c="function",s=n.escapeExpression,u=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"<div>\n\t"+s(typeof(o=null!=(o=u(t,"content")||(null!=e?u(e,"content"):e))?o:i)===c?o.call(r,{name:"content",hash:{},data:l,loc:{start:{line:2,column:1},end:{line:2,column:12}}}):o)+'\n\t<br/>\n\t<br/>\n\t<a class="close-onboarding">'+s(typeof(o=null!=(o=u(t,"confirmationLink")||(null!=e?u(e,"confirmationLink"):e))?o:i)===c?o.call(r,{name:"confirmationLink",hash:{},data:l,loc:{start:{line:5,column:29},end:{line:5,column:49}}}):o)+"</a>\n</div>\n"},useData:!0}),a={};n.Array.each([],(function(e){var t=n.Template.get("hermes/"+e);t&&(a[e]=t)})),n.Template.register("hermes/download-tooltip",(function(e,l){return(l=l||{}).partials=l.partials?n.merge(a,l.partials):a,t(e,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("bulk-downloader-view",(function(e,t){"use strict";e.BulkDownloaderView=e.Base.create("BulkDownloaderView",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.localizeLib=e.mix({langBundles:["common","album-page","cameraroll"],appContext:this.appContext},e.Localizable),this.set("isOwnAlbum",t.isOwnAlbum)},showLoadingDialog:function(){let t=new e.Views["confirmation-dialog-view"]({appContext:this.appContext,showCancelButton:!1,showConfirmButton:!1,htmlMessage:this.templates("flickr-balls")({isBlock:!0}),title:this.intlMessage({intlName:"cameraroll.PREPARING_DOWNLOAD"})});return new e.Views.FluidModal({appContext:this.appContext,subview:t,dismissOnOverlayClick:!1,hasSubviewConfigRefactor:!0}).show()},createTitle:function(e,t){var o="";if(t=t||0,(e=e||0)>0&&t>0)o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS_AND_VIDEO",photoCount:e,videoCount:t});else if(e>0&&0===t)o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS",photoCount:e});else{if(!(0===e&&t>0))throw new Error(this.intlMessage({intlName:"cameraroll.DOWNLOAD_NOT_AVAILABLE_ERROR"}));o=this.intlMessage({intlName:"album-page.DOWNLOAD_VIDEOS",videoCount:t})}return o},createButtonLabel:function(e,t){var o="";return t+e>1?o=this.intlMessage({intlName:"album-page.DOWNLOAD_ZIP"}):1===e&&0===t?o=this.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS",photoCount:e}):0===e&&1===t&&(o=this.intlMessage({intlName:"album-page.DOWNLOAD_VIDEOS",videoCount:t})),o},prepareArchive:function(e){var t=this;return this.appContext.callAPI("flickr.download.archives.create",e).then((function(e){var o,i,n=e.archive.countPhotos,a=e.archive.countVideos,l=e.archive.key;return o=t.createTitle(n,a),i=t.createButtonLabel(n,a),{title:o,downloadURLs:e.archive.urls.map((function(e,t){return{url:e,partSequence:t+1}})),buttonLabel:i,key:l}})).catch((function(e){throw 105===e.code?new Error(t.intlMessage({intlName:"cameraroll.DOWNLOAD_DISABLED_ERROR"})):new Error(t.intlMessage({intlName:"cameraroll.DOWNLOAD_GENERIC_ERROR"}))}))},showDownloadDialog:function(t){var o,i,n=t.title,a=this;t.downloadURLs;(o=t.setID?{set_id:t.setID}:t.share_code?{share_code:t.share_code,gp_code:t.gp_code,gp_owner:t.gp_owner}:{photo_ids:t.photoIDs,owner_id:t.ownerID}).extras="offline_enabled";let l=new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:n,confirmButtonText:this.intlMessage({intlName:"downloadr.CREATE_ZIP"}),htmlMessage:this.templates("bulk-download-modal")({isOwnAlbum:this.get("isOwnAlbum"),loggedOut:!this.appContext.getViewer().signedIn}),onConfirm:()=>(l.setLoading(!0),this.prepareArchive(o).then((e=>{i.close(),this.appContext.getViewer().signedIn?this.showTooltip(e.key):this.appContext.flapp.navigate("/download/"+e.key)})).catch((t=>{i.close(),105===t.code?this.onError(new Error(a.intlMessage({intlName:"cameraroll.DOWNLOAD_DISABLED_ERROR"})),i):(e.config.win.beaconError("[bulk-download] Error creating archive ",e.config.win.location.href,t),this.onError(new Error(a.intlMessage({intlName:"cameraroll.DOWNLOAD_GENERIC_ERROR"})),i))})))});return i=new e.Views.FluidModal({appContext:this.appContext,subview:l,hasSubviewConfigRefactor:!0}).show()},onError:function(t,o){o&&o.close();let i=new e.Views["confirmation-dialog-view"]({appContext:this.appContext,showCancelButton:!1,htmlMessage:t.message,title:this.intlMessage({intlName:"common.ERROR"})});new e.Views.FluidModal({appContext:this.appContext,subview:i,hasSubviewConfigRefactor:!0}).show()},showTooltip:function(t){var o=e.one(".global-nav-view").one(".notifications-menu-view"),i=this;if(o){this.tooltip=new e.Views.FluidDroparound({appContext:this.appContext,htmlMessage:this.templates("download-tooltip")({content:this.intlHTMLMessage({intlName:"downloadr.TOOLTIP_DOWNLOAD_LINK_MESSAGE",url:"/download/"+t}),confirmationLink:this.intlMessage({intlName:"downloadr.TOOLTIP_OK"})}),showDropArrow:!0,dismissOnOverlayClick:!0,observePageResize:!0,anchorElement:o,keyboardAnchorElement:o,minVerticalSpace:400,width:350,positionFixed:!0,preferLeft:!0,closeOnScroll:!0,anchorOffsetVertical:0});var n=this.tooltip.get("container");i.registerEventHandler(n.delegate("click",(function(e){e.preventDefault(),i.tooltip.close()}),".close-onboarding")),this.tooltip.show()}}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-bulk-download-modal","hermes-template-download-tooltip","hermes-template-flickr-balls"],langBundles:["common","downloadr","album-page","cameraroll"],optional:[],affinity:"client"});